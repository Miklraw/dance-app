<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í –î–í–ò–ñ–ï–ù–ò–ò</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --gold: #C5A059; --dark: #080808; --border: rgba(197, 160, 89, 0.2); --glass: rgba(255, 255, 255, 0.04); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { background: var(--dark); color: #F0F0F0; font-family: 'Montserrat', sans-serif; overflow: hidden; }

        /* –§–æ–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ */
        .background-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        #bg-video { width: 100%; height: 100%; object-fit: cover; opacity: 0.35; }
        .video-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(180deg, transparent 0%, var(--dark) 95%); backdrop-filter: blur(1px); }

        header { padding: 35px 20px; text-align: center; border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); z-index: 100; position: relative; }
        .logo-luxe { font-family: 'Playfair Display', serif; font-size: 20px; letter-spacing: 7px; text-transform: uppercase; color: var(--gold); }

        .container { padding: 25px; padding-bottom: 120px; height: calc(100vh - 100px); overflow-y: auto; }
        .—Å—Ç—Ä–∞–Ω–∏—Ü–∞ { display: none; animation: fadeIn 0.4s ease forwards; }
        .—Å—Ç—Ä–∞–Ω–∏—Ü–∞.–∞–∫—Ç–∏–≤–Ω–∞ { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ú–∞–Ω–∏—Ñ–µ—Å—Ç */
        .manifesto-box { text-align: center; padding: 60px 10px; }
        .manifesto-text { font-family: 'Playfair Display', serif; font-style: italic; font-size: 28px; line-height: 1.5; color: #fff; margin-bottom: 20px; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .luxe-btn { 
            background: var(--glass); border: 1px solid var(--border); color: var(--gold); 
            padding: 22px; font-size: 11px; text-transform: uppercase; letter-spacing: 3px; 
            cursor: pointer; width: 100%; margin-bottom: 15px; backdrop-filter: blur(10px); 
            transition: 0.3s;
        }
        .luxe-btn:active { background: var(--gold); color: black; }

        /* –ü—Ä–æ—Ñ–∏–ª—å –∏ –ö–∞—Ä—Ç–∞ */
        .avatar-upload { width: 110px; height: 110px; border: 1px solid var(--gold); margin: 0 auto 25px; background-size: cover; background-position: center; cursor: pointer; border-radius: 2px; }
        .luxe-card { background: var(--glass); border: 1px solid var(--border); padding: 35px 20px; text-align: center; margin-bottom: 20px; }
        .rank-title { font-family: 'Playfair Display', serif; font-size: 32px; font-style: italic; color: var(--gold); margin: 10px 0; }
        .progress-line { height: 1px; background: rgba(197, 160, 89, 0.1); width: 100%; margin: 25px 0; position: relative; }
        .progress-fill { height: 1px; background: var(--gold); position: absolute; left: 0; transition: 2s; box-shadow: 0 0 8px var(--gold); }

        /* –¢–∞–±–±–∞—Ä */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 85px; background: rgba(8,8,8,0.98); display: flex; align-items: center; justify-content: space-around; border-top: 1px solid var(--border); z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .tab-item { color: #444; font-size: 10px; text-transform: uppercase; letter-spacing: 2px; text-decoration: none; display: flex; flex-direction: column; align-items: center; flex: 1; }
        .tab-item.active { color: var(--gold); }
        .tab-dot { width: 3px; height: 3px; background: var(--gold); border-radius: 50%; margin-top: 6px; opacity: 0; }
        .tab-item.active .tab-dot { opacity: 1; }

        /* –†–µ–π—Ç–∏–Ω–≥ */
        .top-section-title { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--gold); margin: 30px 0 15px; font-style: italic; text-align: center; }
        .leader-item { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid var(--glass); font-size: 12px; }
    </style>
</head>
<body>

    <div class="background-wrapper">
        <video autoplay muted loop playsinline id="bg-video"><source src="bg_video.mp4" type="video/mp4"></video>
        <div class="video-overlay"></div>
    </div>

    <header><div class="logo-luxe">–í –î–í–ò–ñ–ï–ù–ò–ò</div></header>

    <div class="container">
        <div id="page-home" class="—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω–∞">
            <div class="manifesto-box">
                <p class="manifesto-text">–î–≤–∏–≥–∞—Ç—å—Å—è. –ß—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å.<br>–°–¥–µ–ª–∞—Ç—å —Å–µ–±—è —Å–∞–º–æ–π.</p>
                <span style="font-size: 10px; letter-spacing: 3px; color: var(--gold); text-transform: uppercase;">üî• 3 –¥–Ω—è –≤ –¥–≤–∏–∂–µ–Ω–∏–∏</span>
            </div>
        </div>

        <div id="page-move-choice" class="—Å—Ç—Ä–∞–Ω–∏—Ü–∞">
            <div style="padding-top: 20px;">
                <button class="luxe-btn" onclick="btnClick('page-offline-menu')">–û–§–§–õ–ê–ô–ù (–í –°–¢–£–î–ò–ò)</button>
                <button class="luxe-btn" onclick="tg.openLink('https://platonovalena.zenclass.ru')">–û–ù–õ–ê–ô–ù (–ê–ö–ê–î–ï–ú–ò–Ø)</button>
            </div>
        </div>

        <div id="page-offline-menu" class="—Å—Ç—Ä–∞–Ω–∏—Ü–∞">
            <button class="luxe-btn" onclick="triggerHaptic()">–ö—É—Ä—Å—ã</button>
            <button class="luxe-btn" onclick="triggerHaptic()">–ú–∞—Å—Ç–µ—Ä –∫–ª–∞—Å—Å—ã</button>
            <button class="luxe-btn" onclick="triggerHaptic()">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</button>
            <button class="luxe-btn" onclick="triggerHaptic(); tg.openLink('https://t.me/platonovalena')">–¢–µ—Ö.–ø–æ–¥–¥–µ—Ä–∂–∫–∞</button>
            <button class="luxe-btn" style="border:none; opacity:0.5; margin-top:10px;" onclick="btnClick('page-move-choice')">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <div id="page-profile" class="—Å—Ç—Ä–∞–Ω–∏—Ü–∞">
            <input type="file" id="ava-input" hidden accept="image/*" onchange="uploadPhoto(this)">
            <div id="user-ava" class="avatar-upload" onclick="document.getElementById('ava-input').click()"></div>
            
            <div class="luxe-card">
                <p style="font-size: 8px; letter-spacing: 2px; opacity: 0.6;">–í–ê–®–ï –ú–ê–°–¢–ï–†–°–¢–í–û</p>
                <div class="rank-title" id="status-name">–î–∏–≤–∞</div>
                <div class="progress-line"><div id="xp-fill" class="progress-fill"></div></div>
                <div style="display: flex; justify-content: space-between; font-size: 9px; color: var(--gold);">
                    <span id="xp-current">0 XP</span>
                    <span>NEXT LEVEL</span>
                </div>
            </div>

            <button class="luxe-btn" style="border-color: var(--gold);" onclick="scanQR()">–°–ö–ê–ù–ò–†–û–í–ê–¢–¨ QR-–ö–û–î</button>
            <button class="luxe-btn" onclick="openBox()">–ü–û–õ–£–ß–ò–¢–¨ –ö–û–ú–ü–õ–ò–ú–ï–ù–¢ –î–ù–Ø</button>

            <div class="top-section-title">Elite Top</div>
            <div id="leaderboard" class="luxe-card" style="padding: 10px; text-align: left;"></div>
        </div>
    </div>

    <nav class="tab-bar">
        <a href="javascript:void(0)" class="tab-item" onclick="showPage('page-move-choice', this)">–î–≤–∏–≥–∞—Ç—å—Å—è<div class="tab-dot"></div></a>
        <a href="javascript:void(0)" id="nav-user-item" class="tab-item" onclick="showPage('page-profile', this)">
            <span id="nav-user-name">–î–∏–≤–∞</span><div class="tab-dot"></div>
        </a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        // –ó–≤—É–∫
        const bellSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
        bellSound.volume = 0.4;

        // –í–∏–±—Ä–∞—Ü–∏—è –∏ –ó–≤—É–∫
        function triggerHaptic() { tg.HapticFeedback.impactOccurred('medium'); }
        function triggerSuccessHaptic() { tg.HapticFeedback.notificationOccurred('success'); }
        function playSuccessSound() { 
            bellSound.currentTime = 0; 
            bellSound.play().catch(() => {}); 
        }

        const –°–¢–ê–¢–£–°–´ = ["–ù–∞—á–∞–ª–æ", "–£—á–µ–Ω–∏—Ü–∞", "–ì—Ä–∞—Ü–∏—è", "–≠—Å—Ç–µ—Ç–∏–∫–∞", "–ú—É–∑–∞", "–ê–º–±–∞—Å—Å–∞–¥–æ—Ä", "–ó–≤–µ–∑–¥–∞", "–ü—Ä–µ–º–∏—É–º –î–∏–≤–∞", "–ü–ª–∞—Ç–∏–Ω–æ–≤–∞—è –î–∏–≤–∞", "–ò–∫–æ–Ω–∞"];
        let state = { 
            xp: parseInt(localStorage.getItem('move_xp')) || 0, 
            name: tg.initDataUnsafe.user?.first_name || "–î–∏–≤–∞", 
            photo: localStorage.getItem('move_photo') || '' 
        };

        function uploadPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { state.photo = e.target.result; localStorage.setItem('move_photo', state.photo); render(); };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function render() {
            const idx = Math.min(Math.floor(state.xp / 100), 9);
            document.getElementById('status-name').innerText = –°–¢–ê–¢–£–°–´[idx];
            document.getElementById('xp-fill').style.width = (state.xp % 100) + '%';
            document.getElementById('xp-current').innerText = (state.xp % 100) + ' XP';
            document.getElementById('nav-user-name').innerText = state.name;
            const ava = document.getElementById('user-ava');
            ava.style.backgroundImage = state.photo ? `url(${state.photo})` : `url('https://ui-avatars.com/api/?name=${state.name}&background=080808&color=C5A059')`;
            
            const leaders = [{n: "–ê–ª–µ–Ω–∞ –ü.", x: 5000}, {n: state.name, x: state.xp, me: true}, {n: "–ú–∞—Ä–∏—è", x: 420}].sort((a,b) => b.x - a.x);
            document.getElementById('leaderboard').innerHTML = leaders.map((u, i) => `
                <div class="leader-item" style="${u.me ? 'color: var(--gold); font-weight: bold;' : ''}">
                    <span>${i+1}. ${u.n}</span><span>${u.x} XP</span>
                </div>`).join('');
        }

        function showPage(pageId, el) {
            document.querySelectorAll('.—Å—Ç—Ä–∞–Ω–∏—Ü–∞').forEach(p => p.classList.remove('–∞–∫—Ç–∏–≤–Ω–∞'));
            document.getElementById(pageId).classList.add('–∞–∫—Ç–∏–≤–Ω–∞');
            if(el) { 
                document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active')); 
                el.classList.add('active'); 
            }
            tg.HapticFeedback.selectionChanged();
        }

        function btnClick(pageId) {
            triggerHaptic();
            showPage(pageId);
        }

        function openBox() {
            triggerHaptic();
            if(localStorage.getItem('move_claimed') == new Date().getDate()) { 
                tg.showAlert("–ñ–¥–µ–º —Ç–µ–±—è –∑–∞–≤—Ç—Ä–∞! ‚ú®"); 
                return; 
            }
            localStorage.setItem('move_claimed', new Date().getDate());
            state.xp += 25; localStorage.setItem('move_xp', state.xp); 
            render();
            playSuccessSound();
            triggerSuccessHaptic();
            confetti({ particleCount: 70, colors: ['#C5A059'], origin: { y: 0.8 } });
        }

        function scanQR() {
            triggerHaptic();
            tg.showScanQrPopup({ text: "–°—Ç—É–¥–∏—è: –ß–µ–∫–∏–Ω" }, (text) => {
                if(text.includes("MOVE")) { 
                    state.xp += 30; localStorage.setItem('move_xp', state.xp); 
                    render(); 
                    playSuccessSound();
                    triggerSuccessHaptic();
                    tg.closeScanQrPopup(); 
                }
            });
        }
        render();
    </script>
</body>
</html>
