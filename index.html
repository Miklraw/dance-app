<input type="file" id="загрузка-фото" accept="image/*" style="display: none;" onchange="обработатьФото(event)">

<script>
    // Функция, которая вызывает окно выбора файла
    function выбратьФайл() {
        tg.HapticFeedback.impactOccurred('medium');
        document.getElementById('загрузка-фото').click();
    }

    // Функция обработки и сохранения фото
    function обработатьФото(event) {
        const файл = event.target.files[0];
        if (!файл) return;

        const читатель = new FileReader();
        читатель.onload = function(e) {
            const фотоBase64 = e.target.result;
            
            // Сохраняем в память телефона
            localStorage.setItem('аватар_пользователя', фотоBase64);
            
            // Обновляем интерфейс
            обновитьАватарки(фотоBase64);
            
            tg.showAlert("Новый образ сохранен! ✨");
        };
        читатель.readAsDataURL(файл);
    }

    function обновитьАватарки(src) {
        document.getElementById('мини-аватар').style.backgroundImage = `url(${src})`;
        const большойАватар = document.getElementById('большой-аватар');
        if (большойАватар) большойАватар.style.backgroundImage = `url(${src})`;
    }

    // Обнови функцию инициализации, чтобы она проверяла сохраненное фото
    function инициализация() {
        const пользователь = tg.initDataUnsafe.user || { first_name: "Дива" };
        const сохраненноеФото = localStorage.getItem('аватар_пользователя');
        
        // Если пользователь сам загрузил фото - ставим его, если нет - берем из ТГ
        const фото = сохраненноеФото || пользователь.photo_url || `https://ui-avatars.com/api/?name=${пользователь.first_name}&background=D81B60&color=fff`;
        
        document.getElementById('имя-пользователя').innerText = пользователь.first_name;
        обновитьАватарки(фото);
        
        // Добавляем возможность клика по большому аватару для смены
        const большойАватар = document.getElementById('большой-аватар');
        if (большойАватар) {
            большойАватар.onclick = выбратьФайл;
            большойАватар.style.cursor = "pointer";
        }
    }
</script>
